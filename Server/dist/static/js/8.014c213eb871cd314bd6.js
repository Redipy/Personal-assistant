webpackJsonp([8],{"3DW4":function(t,e){},mlhU:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l={data:function(){return{pickerOptions:{shortcuts:[{text:"今天",onClick:function(t){t.$emit("pick",new Date)}},{text:"昨天",onClick:function(t){var e=new Date;e.setTime(e.getTime()-864e5),t.$emit("pick",e)}},{text:"一周前",onClick:function(t){var e=new Date;e.setTime(e.getTime()-6048e5),t.$emit("pick",e)}}]},filteroptions:[{value:1,label:"所有任务"},{value:2,label:"个人任务"},{value:3,label:"群组任务"}],nameoptions:[],searchfilter:{type:1,name:""},dialogVisible:!1,adddialogVisible:!1,currentPage:1,length:0,user_id:null,search:"",tableData:[],ruleForm:{name:"",detail:"",type:!1,date:"",group:""},addForm:{name:"",detail:"",type:!1,group:!1,date:"",chose:""},grouplist:[]}},methods:{init:function(){this.$route.params.date?this.search=this.$route.params.date:this.search=new Date,this.loadTable(),this.loadName()},loadTable:function(){var t=this;this.user_id=JSON.parse(sessionStorage.getItem("EX_token")).user_id,this.$http.post(this.url+"/task/findList",{user_id:this.user_id,date:this.dateToString(this.search),pageno:this.currentPage,pagesize:10}).then(function(e){t.length=e.length["count(*)"],t.tableData=e.data;for(var a=0;a<t.tableData.length;a++)if(0===t.tableData[a].task_type?t.tableData[a].task_type="个人任务":1===t.tableData[a].task_type&&(t.tableData[a].task_type="群组任务"),t.tableData[a].task_startdate){var l=t.dateToString(new Date(t.tableData[a].task_startdate))+" 至 "+t.dateToString(new Date(t.tableData[a].task_enddate));t.$set(t.tableData[a],"date",l)}else t.$set(t.tableData[a],"date","日常任务")}).catch(function(t){console.log(t)})},loadFilterTable:function(){var t=this;console.log("111111111111"),this.$http.post(this.url+"/task/findByfilter",{user_id:this.user_id,type:this.searchfilter.type,name:this.searchfilter.name,pageno:this.currentPage,pagesize:10}).then(function(e){console.log(e),t.length=e.length["count(*)"],t.tableData=e.data;for(var a=0;a<t.tableData.length;a++)if(0===t.tableData[a].task_type?t.tableData[a].task_type="个人任务":1===t.tableData[a].task_type&&(t.tableData[a].task_type="群组任务"),t.tableData[a].task_startdate){var l=t.dateToString(new Date(t.tableData[a].task_startdate))+" 至 "+t.dateToString(new Date(t.tableData[a].task_enddate));t.$set(t.tableData[a],"date",l)}else t.$set(t.tableData[a],"date","日常任务")})},loadName:function(){var t=this;this.$http.post(this.url+"/group/getall",{user_id:this.user_id}).then(function(e){t.nameoptions=[];for(var a=0;a<e.data.length;a++)t.nameoptions.push({value:e.data[a].group_id,label:e.data[a].group_name})}).catch(function(t){console.log(t)})},filterchange:function(){switch(console.log(this.searchfilter),this.searchfilter.type){case 1:this.loadTable();break;case 2:case 3:this.loadFilterTable()}},currentChange:function(t){this.currentPage=t,1===this.searchfilter.type?this.loadTable():this.loadFilterTable()},searchTask:function(){var t="";this.search&&(t=this.dateToString(this.search),console.log(t))},addTask:function(){var t=this;this.adddialogVisible=!0,this.$http.post(this.url+"/group/getleaderoradmin",{user_id:this.user_id}).then(function(e){for(var a=0;a<e.data.length;a++)t.grouplist.push({value:e.data[a].group_id,label:e.data[a].group_name})}).catch(function(){})},editDetail:function(t){console.log(t.row),this.ruleForm.id=t.row.task_id,this.ruleForm.name=t.row.task_name,this.ruleForm.detail=t.row.task_detail,"日常任务"!==t.row.date?(this.ruleForm.type=!0,this.ruleForm.date=[new Date(t.row.date.split(" 至 ")[0]),new Date(t.row.date.split(" 至 ")[1])]):(this.ruleForm.type=!1,this.ruleForm.date=t.row.date),console.log(this.ruleForm),this.dialogVisible=!0},no:function(){var t=this;this.$confirm("是否取消修改？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.dialogVisible=!1}).catch(function(){})},noAdd:function(){var t=this;this.$confirm("是否取消新增？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.adddialogVisible=!1}).catch(function(){})},sure:function(){var t=this,e=this;this.$confirm("是否修改？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a="";t.ruleForm.type?a=t.dateToString(t.ruleForm.date[0])+" 至 "+t.dateToString(t.ruleForm.date[1]):a="";t.$http.post(t.url+"/task/update",{task_id:t.ruleForm.id,task_name:t.ruleForm.name,task_detail:t.ruleForm.detail,task_date:a}).then(function(){t.$message({type:"success",message:"修改成功"}),e.filterchange()}),t.dialogVisible=!1}).catch(function(){})},sureAdd:function(){var t=this,e=this;this.user_id=JSON.parse(sessionStorage.getItem("EX_token")).user_id,this.$confirm("是否新增？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){if(t.addForm.group){var a="";if(t.addForm.type)a=t.dateToString(t.addForm.date[0])+" 至 "+t.dateToString(t.addForm.date[1]);else a="";t.$http.post(t.url+"/task/addgroupTask",{task_name:t.addForm.name,task_detail:t.addForm.detail,task_userid:t.user_id,task_date:a,group_id:t.addForm.chose}).then(function(){t.$message({type:"success",message:"新增成功"}),e.loadTable()}),t.adddialogVisible=!1}else{var l="";if(t.addForm.type)l=t.dateToString(t.addForm.date[0])+" 至 "+t.dateToString(t.addForm.date[1]);else l="";t.$http.post(t.url+"/task/addTask",{task_name:t.addForm.name,task_detail:t.addForm.detail,task_userid:t.user_id,task_date:l}).then(function(){t.$message({type:"success",message:"新增成功"}),e.loadTable()}).catch(function(){}),t.adddialogVisible=!1}}).catch(function(){})},closeadd:function(){this.grouplist=[],this.addForm={name:"",detail:"",type:!1,date:""}},over:function(t){var e=this,a=this;this.$confirm("是否结束此任务？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){console.log(t.row.task_id),e.$http.post(e.url+"/task/overTask",{task_id:t.row.task_id}).then(function(t){e.$message({type:"success",message:t.message}),a.loadTable()}).catch(function(){})}).catch(function(){})},dateToString:function(t){var e=t.getFullYear(),a=t.getMonth()+1,l=t.getDate();return a<10&&(a="0"+a),l<10&&(l="0"+l),e+"-"+a+"-"+l}},created:function(){this.init()}},o={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"taskBody"},[a("div",{staticClass:"searchBar"},[a("el-button",{staticClass:"newButton",attrs:{type:"primary",round:""},on:{click:t.addTask}},[t._v("新增任务")]),t._v(" "),a("el-select",{staticClass:"selectfilter",attrs:{placeholder:"请选择"},on:{change:t.filterchange},model:{value:t.searchfilter.type,callback:function(e){t.$set(t.searchfilter,"type",e)},expression:"searchfilter.type"}},t._l(t.filteroptions,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1),t._v(" "),a("div",{staticClass:"tableBody"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,stripe:""}},[a("el-table-column",{attrs:{prop:"task_name",label:"任务",width:""}}),t._v(" "),a("el-table-column",{attrs:{prop:"task_detail",label:"任务描述",width:""}}),t._v(" "),a("el-table-column",{attrs:{prop:"date",label:"执行日期",width:""}}),t._v(" "),a("el-table-column",{attrs:{prop:"task_type",label:"任务类型",width:""}}),t._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return t.editDetail(e)}}},[t._v("编辑")]),t._v(" "),a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return t.over(e)}}},[t._v("完成")])]}}])})],1),t._v(" "),a("el-pagination",{attrs:{small:"",layout:"prev, pager, next","current-page":t.currentPage,total:this.length},on:{"current-change":this.currentChange}})],1),t._v(" "),a("el-dialog",{attrs:{title:"编辑",visible:t.dialogVisible,"close-on-click-modal":!1,"close-on-press-escape":!1,width:"30%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:t.ruleForm,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"任务名称",prop:"name"}},[a("el-input",{model:{value:t.ruleForm.name,callback:function(e){t.$set(t.ruleForm,"name",e)},expression:"ruleForm.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"任务描述",prop:"detail"}},[a("el-input",{model:{value:t.ruleForm.detail,callback:function(e){t.$set(t.ruleForm,"detail",e)},expression:"ruleForm.detail"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"任务类型",prop:"detail"}},[a("el-switch",{attrs:{"active-text":"期限任务","inactive-text":"日常任务"},model:{value:t.ruleForm.type,callback:function(e){t.$set(t.ruleForm,"type",e)},expression:"ruleForm.type"}})],1),t._v(" "),t.ruleForm.type?[a("el-form-item",{attrs:{label:"执行日期",prop:"date"}},[a("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.ruleForm.date,callback:function(e){t.$set(t.ruleForm,"date",e)},expression:"ruleForm.date"}})],1)]:t._e()],2),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){return t.no()}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.sure()}}},[t._v("确 定")])],1)],1),t._v(" "),a("el-dialog",{attrs:{title:"新增",visible:t.adddialogVisible,"close-on-click-modal":!1,"close-on-press-escape":!1,width:"30%"},on:{close:function(e){return t.closeadd()},"update:visible":function(e){t.adddialogVisible=e}}},[a("el-form",{ref:"addForm",staticClass:"demo-ruleForm",attrs:{model:t.addForm,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"任务名称",prop:"name"}},[a("el-input",{model:{value:t.addForm.name,callback:function(e){t.$set(t.addForm,"name",e)},expression:"addForm.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"任务描述",prop:"detail"}},[a("el-input",{model:{value:t.addForm.detail,callback:function(e){t.$set(t.addForm,"detail",e)},expression:"addForm.detail"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"任务类型",prop:"detail"}},[a("el-switch",{attrs:{"active-text":"期限任务","inactive-text":"日常任务"},model:{value:t.addForm.type,callback:function(e){t.$set(t.addForm,"type",e)},expression:"addForm.type"}})],1),t._v(" "),t.addForm.type?[a("el-form-item",{attrs:{label:"执行日期",prop:"date"}},[a("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.addForm.date,callback:function(e){t.$set(t.addForm,"date",e)},expression:"addForm.date"}})],1)]:t._e(),t._v(" "),a("el-form-item",{attrs:{label:"群组/个人",prop:"detail"}},[a("el-switch",{attrs:{"active-text":"群组任务","inactive-text":"个人任务"},model:{value:t.addForm.group,callback:function(e){t.$set(t.addForm,"group",e)},expression:"addForm.group"}})],1),t._v(" "),t.addForm.group?[a("el-form-item",{attrs:{label:"群组名称",prop:"group"}},[a("el-select",{attrs:{filterable:"",placeholder:"请选择"},model:{value:t.addForm.chose,callback:function(e){t.$set(t.addForm,"chose",e)},expression:"addForm.chose"}},t._l(t.grouplist,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1)]:t._e()],2),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){return t.noAdd()}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.sureAdd()}}},[t._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var r=a("VU/8")(l,o,!1,function(t){a("3DW4")},null,null);e.default=r.exports}});
//# sourceMappingURL=8.014c213eb871cd314bd6.js.map